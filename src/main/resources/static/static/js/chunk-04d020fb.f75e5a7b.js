(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-04d020fb"],{"413a":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-card",{staticStyle:{border:"none"},attrs:{"body-style":"margin:5px; padding:0; height:98vh;overflow: auto"}},[r("div",[r("el-scrollbar",[r("el-form",{ref:"form",staticClass:"scrollbar-flex-content",attrs:{inline:!0,model:e.form}},[r("el-form-item",{staticClass:"scrollbar-demo-item1",staticStyle:{"margin-left":"10px"},attrs:{label:"查询类型"}},[r("el-select",{staticStyle:{width:"150px"},attrs:{placeholder:"请选择查询类型"},model:{value:e.form.searchTypeValue,callback:function(t){e.$set(e.form,"searchTypeValue",t)},expression:"form.searchTypeValue"}},e._l(e.form.searchType,(function(e,t){return r("el-option",{attrs:{label:e,value:e}})})),1),""==e.form.searchTypeValue?r("el-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.search}},[e._v("查看全部知识图谱")]):e._e()],1),"按节点查询"==e.form.searchTypeValue?r("el-form-item",{staticClass:"scrollbar-demo-item1",attrs:{label:"关键词"}},[r("el-input",{staticStyle:{width:"350px"},attrs:{placeholder:"请输入节点标签或属性"},model:{value:e.form.nodeInput,callback:function(t){e.$set(e.form,"nodeInput",t)},expression:"form.nodeInput"}})],1):e._e(),"按节点查询"==e.form.searchTypeValue?r("el-form-item",{staticClass:"scrollbar-demo-item3"},[r("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.searchByProperty}}),r("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.search}},[e._v("查看全部知识图谱")])],1):e._e(),"按关系查询"==e.form.searchTypeValue?r("el-form-item",{staticClass:"scrollbar-demo-item1",attrs:{label:"关系名"}},[r("el-select",{staticStyle:{width:"350px"},attrs:{placeholder:"请选择关系"},model:{value:e.form.relInput,callback:function(t){e.$set(e.form,"relInput",t)},expression:"form.relInput"}},e._l(e.linkTypeOptions,(function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),"按关系查询"==e.form.searchTypeValue?r("el-form-item",{staticClass:"scrollbar-demo-item3"},[r("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.searchByRel}}),r("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.search}},[e._v("查看全部知识图谱")])],1):e._e()],1)],1)],1),r("div",{staticStyle:{height:"100%"}},[r("div",{staticStyle:{width:"100%",float:"left"}},[r("cvs",{ref:"cvs",attrs:{"which-parent":"0",domain:"知识图谱"},on:{clickNode:e.queryNodeInfo,dbclickNode:e.queryNodeProp,insertNodeInfo:e.insertNode,insertRelInfo:e.insertRel,deleteNodeInfo:e.deleteNode}},[r("detail-panel",{staticClass:"detail-panel",attrs:{"relation-ship":e.relations,"panel-info":e.panelInfo,"which-parent":"0"},on:{getNewGraphSource:e.getNewGraphSource}}),r("el-dialog",{attrs:{visible:e.insertRelVis,title:"请输入添加关系的信息"},on:{"update:visible":function(t){e.insertRelVis=t}}},[r("el-input",{attrs:{placeholder:"请输入边名"},model:{value:e.insertRelValue,callback:function(t){e.insertRelValue=t},expression:"insertRelValue"}}),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.insertRelVis=!1}}},[e._v("取 消 ")]),r("el-button",{attrs:{type:"primary"},on:{click:e.insertRel}},[e._v("确 定")])],1)],1)],1)],1),r("div",{staticClass:"cvs-footer"},[r("div",{directives:[{name:"show",rawName:"v-show",value:e.currentLabel,expression:"currentLabel"}],staticStyle:{display:"flex","align-items":"baseline"}},[r("span",[e._v("Size:")]),r("ul",{staticClass:"size-ul"},e._l(e.sizes,(function(t,a){return r("li",{key:"size-"+a,staticClass:"size-li"},[r("a",{staticClass:"size-item",style:"height:"+t+";width:"+t+";",on:{click:function(t){return e.selectSize(a)}}})])})),0)])])])])},s=[],o=r("0d9f"),n=r("435f"),i=(r("bb13"),r("89a8"),r("b110"),r("fe35"),r("87d5"),r("b233"),r("10dd"),r("993f"),r("51a9"),r("0560"),r("71f7")),l=r("db94"),c={name:"AttributeCharacteristicsAtlas",components:{cvs:l["a"],DetailPanel:i["a"]},props:{isShow:{type:Boolean,default:!0}},data:function(){return{domain:"知识图谱",form:{labelType:[],labelSelect:"",propertySelect:"",propertyType:[],propertyInput:"",searchType:["按节点查询","按关系查询"],searchTypeValue:"",relInput:"",nodeInput:""},queryId:"",cancleVis:!1,insertRelValue:"",insertRelVis:!1,delRelSource:"",rel:{source:"",target:"",name:""},editVis:!1,insertVis:!1,btnVis:!1,relations:[],panelInfo:{properties:{}},options:[],graphSource:{nodes:[],links:[]},graphInfo:{nodesInfo:[],linksInfo:[]},currentLabel:"",sizes:["12px","14px","16px","18px","20px"],searchValue:["轰炸机","乘员"],searchContent:"4",idToIndexList:new Map,linkTypeOptions:[]}},created:function(){this.getSearchLabel(),this.getRelName(),null!=localStorage.getItem("id")&&""!=localStorage.getItem("id")?(console.log(localStorage.getItem("id")),this.queryId=localStorage.getItem("id"),this.searchById(this.queryId),localStorage.removeItem("id")):null!=this.$route.query.id&&""!=this.$route.query.id&&(console.log(this.$route.query.id),this.queryId=this.$route.query.id,this.searchById(this.queryId))},beforeDestroy:function(){loalStorage.clear()},methods:{getRelName:function(){var e=this;this.axios.get("http://localhost:8082/KG/getRelLabel",{params:{domain:this.domain}}).then((function(t){var r=t.data.data;if(console.log("关系",t),200===t.data.code){console.log("获取关系类型",r);var a,s=Object(n["a"])(r);try{for(s.s();!(a=s.n()).done;){var o=a.value;e.linkTypeOptions.push({label:o,value:o})}}catch(i){s.e(i)}finally{s.f()}}}))},getNewGraphSource:function(e){var t=JSON.parse(JSON.stringify(e));console.log("获取新的数据源",t);var r,a=function(e,t){var r,a=Object(n["a"])(e);try{for(a.s();!(r=a.n()).done;){var s=r.value;if(s.id===t)return!0}}catch(o){a.e(o)}finally{a.f()}return!1},s=e.nodes,o=e.links,i=Object(n["a"])(s);try{for(i.s();!(r=i.n()).done;){var l=r.value;a(this.graphSource.nodes,l.id)||this.graphSource.nodes.push(l)}}catch(u){i.e(u)}finally{i.f()}var c,d=Object(n["a"])(o);try{for(d.s();!(c=d.n()).done;){var h=c.value;a(this.graphSource.links,h.id)||this.graphSource.links.push(h)}}catch(u){d.e(u)}finally{d.f()}console.log("13"),console.log(this.graphSource),this.$refs["cvs"].renderGraph(this.graphSource)},getSearchLabel:function(){var e=this,t=this;t.axios.get("http://localhost:8082/KG/getLabel",{params:{domain:this.domain}}).then((function(t){console.log(t),e.form.labelType=t.data.data}))},getSearchLabelProperty:function(){var e=this;this.form.propertySelect="";var t=this;t.axios.get("http://localhost:8082/KG/getLabelProperty",{params:{domain:this.domain,label:this.form.labelSelect}}).then((function(t){console.log(t),e.form.propertyType=t.data.data}))},cancle:function(){this.cancleVis=!1,this.rel.source="",this.delRelSource=""},deleteRelSource:function(e){this.delRelSource=e,this.$message.info("请选择删除关系的目标节点！"),this.cancleVis=!0},insertRelSource:function(e){this.rel.source=e,this.$message.info("请选择连线的目标节点！"),this.cancleVis=!0,console.log("cancleVis:"+this.cancleVis)},searchByRel:function(){var e=this,t=this;t.axios.get("http://localhost:8082/KG/searchByRel",{params:{domain:t.domain,relName:t.form.relInput}}).then((function(t){console.log(t.data.data),(""!=e.graphSource.nodes&&null!=e.graphSource.nodes||""!=e.graphSource.links&&null!=e.graphSource.links)&&(e.graphSource.nodes=[],e.graphSource.links=[],e.panelInfo={properties:{}},console.log("清空图"));var r,a=t.data.data.node,s=[],o=Object(n["a"])(t.data.data.link);try{for(o.s();!(r=o.n()).done;){var i=r.value;s.push({id:i.id,index:0,source:i.sourceId,target:i.targetId,name:i.name})}}catch(l){o.e(l)}finally{o.f()}a.length?(e.$message({type:"success",message:"共查询到"+a.length+"个节点"}),e.graphSource={nodes:a,links:s},e.$refs["cvs"].renderGraph(e.graphSource)):e.$message({showClose:!0,message:"未查到相关数据"})}))},searchByProperty:function(){var e=this,t=this;t.axios.get("http://localhost:8082/KG/searchByKeyword",{params:{domain:this.domain,keyword:this.form.nodeInput}}).then((function(t){console.log(t),(""!=e.graphSource.nodes&&null!=e.graphSource.nodes||""!=e.graphSource.links&&null!=e.graphSource.links)&&(e.graphSource.nodes=[],e.graphSource.links=[],e.panelInfo={properties:{}},console.log("清空图"));var r=t.data.data;if(!r.length)return e.$message({showClose:!0,message:"未查到相关数据"}),void e.$refs["cvs"].renderGraph(e.graphSource);e.$message({type:"success",message:"共查询到"+r.length+"个节点"}),e.graphSource={nodes:r,links:[]},e.$refs["cvs"].renderGraph(e.graphSource)}))},search:function(){var e=this;console.log(this.panelInfo);var t=this;t.axios.get("http://localhost:8082/KG/getGraph",{params:{domain:this.domain}}).then((function(t){if(console.log(t),200==t.data.code){console.log(t.data.data),(""!=e.graphSource.nodes&&null!=e.graphSource.nodes||""!=e.graphSource.links&&null!=e.graphSource.links)&&(e.graphSource.nodes=[],e.graphSource.links=[],e.panelInfo={properties:{}},console.log("清空图"));var r,a=t.data.data.node,s=[],o=Object(n["a"])(t.data.data.link);try{for(o.s();!(r=o.n()).done;){var i=r.value;s.push({id:i.id,index:0,source:i.sourceId,target:i.targetId,name:i.name})}}catch(l){o.e(l)}finally{o.f()}if(!a.length)return void e.$message({showClose:!0,message:"未查到相关数据"});e.$message({type:"success",message:"共查询到"+a.length+"个节点"}),e.graphSource={nodes:a,links:s},e.$refs["cvs"].renderGraph(e.graphSource)}})).catch((function(e){return console.log(e)}))},searchById:function(e){var t=this;console.log(this.panelInfo);var r=this;r.axios.get("http://localhost:8082/KG/searchNodeAndRel",{params:{id:e,domain:this.domain}}).then((function(e){if(console.log(e),200==e.data.code&&e.data.data){var a,s=e.data.data.node,o=[],i=Object(n["a"])(e.data.data.link);try{for(i.s();!(a=i.n()).done;){var l=a.value;o.push({id:l.id,index:0,source:l.sourceId,target:l.targetId,name:l.name})}}catch(c){i.e(c)}finally{i.f()}t.graphSource={nodes:s,links:o},r.$refs["cvs"].renderGraph(t.graphSource),r.panelInfo=s[0]}})).catch((function(e){return console.log(e)}))},insertNode:function(e){var t=this,r=this;console.log(e),r.axios.post("http://localhost:8082/KG/createNode",e.property,{params:{domain:this.domain,name:e.name,type:e.type}}).then((function(e){console.log("增加节点响应数据",e),200==e.data.code&&(r.graphSource.nodes.push(e.data.data),r.$refs["cvs"].renderGraph(t.graphSource),r.insertVis=!1,r.$message({type:"success",message:"新增节点成功"}))}))},deleteNode:function(e){var t=this;console.log("要删除的节点index",e);var r=e.id,a=this;a.axios.delete("http://localhost:8082/KG/node",{params:{id:r}}).then((function(s){if(console.log("删除节点响应数据index",s),200==s.data.code){if(a.$message.success("删除节点成功"),t.idToIndexList.has(r)){var i=t.idToIndexList.get(r);t.graphSource.nodes.splice(i.nodeStart,i.number),t.graphSource.links.splice(i.linkStart,i.number);var l,c=Object(n["a"])(t.idToIndexList.entries());try{for(c.s();!(l=c.n()).done;){var d=Object(o["a"])(l.value,2),h=d[0],u=d[1];i.nodeStart<u.nodeStart&&(t.idToIndexList.get(h).nodeStart-=i.number,t.idToIndexList.get(h).linkStart-=i.number)}}catch(g){c.e(g)}finally{c.f()}t.idToIndexList.delete(r)}t.graphSource.nodes.splice(e.index,1);for(var p=t.graphSource.links.length-1;p>=0;p--)console.log(t.graphSource.links[p]),t.graphSource.links[p].source.id!=r&&t.graphSource.links[p].target.id!=r||(console.log("删除关系边",t.graphSource.links[p]),t.graphSource.links.splice(p,1))}})).then((function(){a.$refs["cvs"].renderGraph(t.graphSource),a.panelInfo={properties:{}}}))},insertRel:function(e){var t=this;console.log("resCanvas",e),this.rel.source=e.sourceId,this.rel.target=e.targetId,this.rel.name=e.name,console.log("插入边信息："+this.rel);var r=this;r.axios.get("http://localhost:8082/KG/createRel",{params:{source:this.rel.source,target:this.rel.target,name:this.rel.name,domain:this.domain}}).then((function(e){console.log(e),200==e.data.code&&(r.$message({type:"success",message:"新增关系成功"}),r.graphSource.links.push({id:e.data.data.id,index:0,source:e.data.data.sourceId,target:e.data.data.targetId,name:e.data.data.name}),r.$refs["cvs"].renderGraph(t.graphSource),t.insertRelVis=!1,t.insertRelValue="",t.rel.source="",t.cancleVis=!1)}))},queryNodeProp:function(e){if("属性"!==e.type&&"事件"!==e.type){if(console.log("节点的信息",e),this.idToIndexList.has(e.id)){console.log("更新画布前if");var t=this.idToIndexList.get(e.id);this.graphSource.nodes.splice(t.nodeStart,t.number),this.graphSource.links.splice(t.linkStart,t.number);var r,a=Object(n["a"])(this.idToIndexList.entries());try{for(a.s();!(r=a.n()).done;){var s=Object(o["a"])(r.value,2),i=s[0],l=s[1];t.nodeStart<l.nodeStart&&(this.idToIndexList.get(i).nodeStart-=t.number,this.idToIndexList.get(i).linkStart-=t.number)}}catch(S){a.e(S)}finally{a.f()}this.idToIndexList.delete(e.id)}else{var c=this.graphSource.nodes.length,d=this.graphSource.links.length,h=0;console.log(e);for(var u=0,p=Object.entries(e.properties);u<p.length;u++){var g=Object(o["a"])(p[u],2),f=g[0],m=g[1];"无"!==m&&m&&m!==e.name&&(this.graphSource.nodes.push({id:e.id+f,name:m,properties:{name:m},type:"属性"}),this.graphSource.links.push({id:0,source:e.id,target:e.id+f,properties:{},name:f}),h++)}console.log("更新画布前else"),this.idToIndexList.set(e.id,{nodeStart:c,linkStart:d,number:h})}console.log("更新画布前"),this.$refs["cvs"].renderGraph(this.graphSource)}},queryNodeInfo:function(e){var t=this;if(console.log(e),""!=this.delRelSource){var r=this.delRelSource,a=e.id,s=this;if(this.graphSource.links.find((function(e){return e.source.id==r&&e.target.id==a}))||this.graphSource.links.find((function(e){return e.source.id==a&&e.target.id==r}))){var o=this.graphSource.links.find((function(e){return e.source.id==r&&e.target.id==a}));this.graphSource.links.find((function(e){return e.source.id==a&&e.target.id==r}))&&(o=this.graphSource.links.find((function(e){return e.source.id==a&&e.target.id==r}))),this.$confirm("此操作将永久删除该关系，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){s.axios.delete("http://localhost:8082/KG/rel",{params:{id:o.id}}).then((function(e){console.log(e),t.graphSource.links.splice(o.index,1),t.$refs["cvs"].renderGraph(t.graphSource),s.delRelSource="",t.cancleVis=!1}))})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))}else this.$message.error("不能删除不存在的关系！")}if(""==this.rel.source)console.log("获取点击的节点",e),this.btnVis=!0,this.panelInfo=e,"属性"!=e.type||(this.relations=[]);else{r=this.rel.source,a=e.id;r==a?(this.$message.error("不能连线自身节点！"),this.rel.source=""):this.graphSource.links.find((function(e){return e.source.id==r&&e.target.id==a}))||this.graphSource.links.find((function(e){return e.source.id==a&&e.target.id==r}))?(this.$message.error("不能添加已有连线！"),this.rel.source=""):(this.rel.target=e.id,this.insertRelVis=!0)}}}},d=c,h=(r("d391"),r("cba8")),u=Object(h["a"])(d,a,s,!1,null,null,null);t["default"]=u.exports},d391:function(e,t,r){"use strict";r("e30f")},e30f:function(e,t,r){}}]);