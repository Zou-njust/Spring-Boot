(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3890c2e8"],{"07b7":function(e,t,a){"use strict";a("1f94")},"1f94":function(e,t,a){},"71f7":function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"card-container"},[a("el-card",{staticClass:"detailCard",attrs:{"body-style":"max-height:400px;overflow:auto"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("节点信息")]),"1"!==e.advanceSearch?a("el-button",{staticStyle:{"margin-left":"150px"},attrs:{type:"primary",icon:"el-icon-edit",circle:"",size:"medium"},on:{click:e.editNodeBefore}}):e._e()],1),a("el-dialog",{attrs:{title:"修改节点属性",visible:e.dialogEditNodeVisible},on:{"update:visible":function(t){e.dialogEditNodeVisible=t}}},[a("el-dialog",{attrs:{width:"30%",title:"添加属性",visible:e.innerVisible,"append-to-body":""},on:{"update:visible":function(t){e.innerVisible=t}}},[a("el-form",{attrs:{"label-width":"80px",model:e.addPropertyForm,rules:e.addPropertyFormRules}},[a("el-form-item",{attrs:{label:"属性名"}},[a("el-input",{model:{value:e.addPropertyForm.key,callback:function(t){e.$set(e.addPropertyForm,"key",t)},expression:"addPropertyForm.key"}})],1),a("el-form-item",{attrs:{label:"属性值"}},[a("el-input",{model:{value:e.addPropertyForm.value,callback:function(t){e.$set(e.addPropertyForm,"value",t)},expression:"addPropertyForm.value"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.innerVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.addProperty}},[e._v("确 定")])],1)],1),a("el-table",{staticStyle:{width:"900px",overflow:"auto"},attrs:{data:e.editNodeList,"max-height":"380px"}},[a("el-table-column",{attrs:{prop:"key",label:"属性名",width:"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(void 0===e.nameMap.get(t.row.key)?t.row.key:e.nameMap.get(t.row.key))+" ")]}}])}),a("el-table-column",{attrs:{label:"属性值",width:"350",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:t.row.val,clearable:""},model:{value:t.row.edit,callback:function(a){e.$set(t.row,"edit",a)},expression:"scope.row.edit"}})]}}])}),a("el-table-column",{attrs:{label:"操作",width:"120",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.deleteProperty(t.$index,t.row)}}},[e._v("删除")])]}}])})],1),a("el-row",{staticStyle:{"margin-top":"20px"}},[a("el-button",{staticStyle:{"margin-left":"5%",float:"left"},attrs:{type:"primary",plain:""},on:{click:function(t){e.innerVisible=!0}}},[e._v("添加属性")]),a("el-button",{staticStyle:{"margin-right":"8%",float:"right"},on:{click:function(t){e.dialogEditNodeVisible=!1}}},[e._v("取 消")]),a("el-button",{staticStyle:{"margin-right":"3%",float:"right"},attrs:{type:"success",plain:""},on:{click:e.editNode}},[e._v("确 定")])],1)],1),a("div",{staticClass:"panel-container"},[a("ul",{staticClass:"info-list",staticStyle:{"margin-left":"20px"},style:{display:e.isDiaplayInfo}},[a("li",[a("span",[e._v("节点名称: ")]),e._v(e._s(e.panelInfo.name))]),a("li",[a("span",[e._v("标签: ")]),e._v(e._s(e.panelInfo.type))]),e._l(Object.entries(e.panelInfo.properties),(function(t,n){return a("span",{key:n},["name"!==t[0]&&"id"!==t[0]&&"tablename"!==t[0]&&"es_index_id"!==t[0]?a("li",[a("span",[e._v(e._s(void 0===e.nameMap.get(t[0])?t[0]:e.nameMap.get(t[0]))+": ")]),"[]"===t[1]?a("span",[e._v("无")]):"true"===t[1]?a("span",[e._v("是")]):a("span",[e._v(e._s(t[1]))])]):e._e()])}))],2)])],1),a("el-dialog",{attrs:{title:"请选择您要查询的时间范围",visible:e.popover,"modal-append-to-body":!1},on:{"update:visible":function(t){e.popover=t}}},[a("el-date-picker",{attrs:{type:"daterange",align:"left","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyyMMdd",format:"yyyy-MM-dd","picker-options":e.pickerOptions},model:{value:e.dateValue,callback:function(t){e.dateValue=t},expression:"dateValue"}}),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.popover=!1,e.value=""}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.findEventsByRelationship}},[e._v("确 定")])],1)],1)],1)},o=[],i=a("9aa5"),r=i["a"],s=(a("d9da"),a("cba8")),l=Object(s["a"])(r,n,o,!1,null,null,null);t["a"]=l.exports},"9aa5":function(e,t,a){"use strict";(function(e){var n=a("0d9f"),o=a("435f"),i=(a("bb13"),a("89a8"),a("b110"),a("fe35"),a("10dd"),a("2788"),a("aa08"),a("993f"),a("51a9"),a("b3d9"),a("4c1e"),a("fee8"),a("8ea3"),new Map([["ISOVERSEAS","是否海外目标"],["basicInfo","基本信息"],["birthDate","出生日期"],["career","职业"],["count","关系数量"],["country","国家"],["crawlerSource","爬虫来源"],["detailInfo","详细信息"],["dsad","dsad"],["event","事件"],["facebookAccount","facebook账户"],["foreignName","英文名"],["gender","性别"],["graduatedSchool","毕业学校"],["guid","唯一标识"],["guidHBase","guidHBase标识"],["id","编号"],["lastModifiedDate","最后修改时间"],["localCrawlerFlag","本地爬虫"],["ming","ming"],["name","名称"],["nationality","民族"],["p1","p1"],["p2","p2"],["pageType","来源类型"],["pageUrl","来源地址"],["picUrl","图片地址"],["poster","发布者"],["ptmc","ptmc"],["publishTime","发布时间"],["relationList","关系列表"],["rwId","人物编号"],["rwName","人物姓名"],["rwTags","人物标签"],["siteName","网站名称"],["summary","摘要"],["test","测试"],["time","时间"],["twitterAccount","推特账户"],["twitterzh","推特转发"],["type","类型"],["url","网页地址"]]));t["a"]={name:"DetailPanel",props:{panelInfo:Object,relationShip:Array,whichParent:String,advanceSearch:String},data:function(){return{new_item:{label:"",nodes:[]},innerVisible:!1,addPropertyForm:{key:"",value:""},addPropertyFormRules:{key:[{required:!0,message:"请填写属性名",trigger:"blur"}],value:[{required:!0,message:"请填写属性值",trigger:"blur"}]},deleteBtnDis:!1,value:"",pickerOptions:{shortcuts:[{text:"最近一周",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-6048e5),e.$emit("pick",[a,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-2592e6),e.$emit("pick",[a,t])}},{text:"最近三个月",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-7776e6),e.$emit("pick",[a,t])}},{text:"最近六个月",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-15552e6),e.$emit("pick",[a,t])}},{text:"最近一年",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-31536e6),e.$emit("pick",[a,t])}}]},dateValue:"",popover:!1,dialogEditNodeVisible:!1,editNodeList:[],formLabelWidth:"120px",isDiaplayInfo:"none",disabled:!1,nameMap:{}}},computed:{graphId:function(){return this.$store.getters.getChildGraphId}},watch:{panelInfo:function(){this.value="",this.panelInfo.name?this.isDiaplayInfo="":this.isDiaplayInfo="none"},popover:function(){this.popover||(this.value="")},graphId:function(){-1!==this.graphId?this.disabled=!0:this.disabled=!1}},created:function(){this.nameMap=i},methods:{toKG:function(e,t){this.$router.push({name:"关联查询",params:{type:e,name:t}})},toSearchResultDetails:function(e,t){var a=e.es_index_id,n=e.tablename;this.$router.push({name:"搜索结果",params:{id:a,es_table_name:n,neo4j_id:t}})},editChooseNodes:function(t,a){var n=0;console.log("节点个数");var i,r=Object(o["a"])(e.globalSentChooseNodes);try{for(r.s();!(i=r.n()).done;){var s=i.value;n+=s.nodes.length,console.log(s.nodes.length),console.log(n)}}catch(y){r.e(y)}finally{r.f()}if(n>=4)this.$message.warning("选择的节点不能多于4个");else if(console.log("choose noeds type"),console.log(t),null!=a){console.log("global.globalChooseNodes1"),console.log(e.globalChooseNodes),e.globalChooseNodes.includes(a)?e.globalChooseNodes.splice(e.globalChooseNodes.indexOf(a),1):e.globalChooseNodes.push(a),console.log("global.globalChooseNodes2"),console.log(e.globalChooseNodes);var l,d=0,c=Object(o["a"])(t);try{for(c.s();!(l=c.n()).done;){var u,p=l.value,g=Object(o["a"])(e.globalSentChooseNodes);try{for(g.s();!(u=g.n()).done;){var h=u.value;if(h.label===p)return d=1,h.nodes.includes(a)?h.nodes.splice(h.nodes.indexOf(a),1):h.nodes.push(a),console.log("global.globalSentChooseNodes"),void console.log(e.globalSentChooseNodes)}}catch(y){g.e(y)}finally{g.f()}}}catch(y){c.e(y)}finally{c.f()}if(0==d){var m,f=Object(o["a"])(t);try{for(f.s();!(m=f.n()).done;){var k=m.value;this.new_item.label=k,this.new_item.nodes.push(a);var v={label:k,nodes:[a]};return e.globalSentChooseNodes.push(v),console.log("global.globalSentChooseNodes"),void console.log(e.globalSentChooseNodes)}}catch(y){f.e(y)}finally{f.f()}}}},deleteProperty:function(e,t){var a=this;console.log(t),this.$confirm("是否确定删除属性 "+t.key,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var n={label:a.panelInfo.type,id:a.panelInfo.id,list:[t.key]},o="";switch(a.whichParent){case"0":o="/ga/deleteProp";case"1":o="/ga/deletePropInNeo4j"}a.$http.post(o,n).then((function(t){console.log(t),200===t.data.code&&(a.$message.success("删除成功"),a.editNodeList.splice(e,1))}))}))},addProperty:function(){this.editNodeList.push({key:this.addPropertyForm.key,val:this.addPropertyForm.value,edit:""}),this.innerVisible=!1},editNodeBefore:function(){if(-1!==this.graphId||"0"!==this.whichParent){this.editNodeList=[];for(var e=0,t=Object.entries(this.panelInfo.properties);e<t.length;e++){var a=t[e];"name"!==a[0]&&"id"!==a[0]&&this.editNodeList.push({key:a[0],val:a[1],edit:""})}this.dialogEditNodeVisible=!0}else this.$message.warning("请先选择或保存子图")},editNode:function(){var e,t=this,a={},n=Object(o["a"])(this.editNodeList);try{for(n.s();!(e=n.n()).done;){var i=e.value;i.edit&&""!=i.editMap&&("name"===i.key&&(this.panelInfo.name=i.edit),i.val=i.edit),a[i.key]=i.val}}catch(r){n.e(r)}finally{n.f()}this.panelInfo.properties=a,console.log("修改节点"+this.panelInfo.properties),this.axios.post("http://localhost:8082/KG/editNode",this.panelInfo.properties,{params:{id:this.panelInfo.id}}).then((function(e){console.log("res编辑",e.data),200===e.data.code?(t.dialogEditNodeVisible=!1,t.$message.success("修改节点成功")):(t.dialogEditNodeVisible=!1,t.$message({type:"error",message:e.data.message}))}))},findEventsByRelationship:function(){var e=this;if(""===this.dateValue)return this.$message.error("请选择正确的时间范围！");var t={endTime:this.dateValue[1],startTime:this.dateValue[0]};this.getDataSource("/graph/neighbour/event/".concat(this.panelInfo.id,"/").concat(this.value.split(",")[0]),{params:t}).then((function(){e.popover=!1}))},findNodesByRelationship:function(e){console.log(e);var t=e.split(","),a=Object(n["a"])(t,2),o=a[0],i=a[1];"事件"===i?(console.log("你选择的是事件类型的关系"),this.popover=!0):this.getDataSource("/graph/neighbour/".concat(this.panelInfo.id,"/").concat(o))},getDataSource:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.$http.get(e,a).then((function(e){if(200===e.data.code){console.log(e.data);var a=e.data.data;if(!a.nodes.length)return t.$message({showClose:!0,type:"info",message:"未查到相关数据"});void 0!==a.links&&a.links.map((function(e){return e["source"]=e["sourceId"],delete e["sourceId"],e["target"]=e["targetId"],delete e["targetId"],e})),console.log(a.links),t.$emit("getNewGraphSource",a)}})).catch((function(e){return console.log(e)}))}}}}).call(this,a("2409"))},bd3a:function(e,t,a){},d9da:function(e,t,a){"use strict";a("bd3a")},db94:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"container",attrs:{"element-loading-text":"保存子图中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"}},[a("div",{staticClass:"canvas-container"},[e._t("default"),"1"!==e.advanceSearch?a("div",{staticStyle:{position:"absolute",bottom:"10px",right:"10px"}},[a("el-button",{staticClass:"deleteBtn",attrs:{icon:"el-icon-delete",circle:"",disabled:e.deleteBtnDis},on:{click:e.deleteNodeFn}}),a("el-button",{staticClass:"addBtn",attrs:{icon:"el-icon-plus",circle:""},on:{click:e.addNodeOrLinkBefore}})],1):e._e(),a("el-dialog",{attrs:{title:"创建节点或关系",visible:e.dialogAddLinkVisible,"modal-append-to-body":!1,width:"35%"},on:{"update:visible":function(t){e.dialogAddLinkVisible=t}}},[a("el-radio-group",{staticStyle:{"margin-bottom":"20px"},model:{value:e.addNodeOrLink,callback:function(t){e.addNodeOrLink=t},expression:"addNodeOrLink"}},[a("el-radio",{attrs:{label:"node"}},[e._v("节点")]),a("el-radio",{attrs:{label:"link"}},[e._v("关系")])],1),"node"===e.addNodeOrLink?a("div",{attrs:{align:"center"}},[a("el-form",{ref:"addNodeFormRef",attrs:{model:e.addNodeForm,rules:e.addNodeFormRules}},[a("div",{staticStyle:{"margin-left":"5%"},attrs:{align:"left"}},[a("el-form-item",{attrs:{prop:"name"}},[a("el-input",{staticStyle:{width:"90%"},attrs:{placeholder:"请输入节点名称"},model:{value:e.addNodeForm.name,callback:function(t){e.$set(e.addNodeForm,"name",t)},expression:"addNodeForm.name"}})],1),a("el-form-item",{staticStyle:{"margin-top":"20px"},attrs:{prop:"type"}},[a("el-select",{staticStyle:{width:"90%"},attrs:{placeholder:"请选择节点类型"},model:{value:e.addNodeForm.type,callback:function(t){e.$set(e.addNodeForm,"type",t)},expression:"addNodeForm.type"}},e._l(e.nodeTypeOptions,(function(e){return a("el-option",{key:e.value,attrs:{value:e.label,label:e.value}})})),1)],1),1==e.addPropertyView?a("div",[a("el-table",{attrs:{data:e.editProperty,width:"500px","max-height":"200px"}},[a("el-table-column",{attrs:{prop:"key",label:"属性名",width:"170px",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{placeholder:t.row[0],clearable:""},model:{value:t.row[0],callback:function(a){e.$set(t.row,0,a)},expression:"scope.row[0]"}})]}}],null,!1,3638090253)}),a("el-table-column",{attrs:{label:"属性值",width:"170px",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{placeholder:t.row[1],clearable:""},model:{value:t.row[1],callback:function(a){e.$set(t.row,1,a)},expression:"scope.row[1]"}})]}}],null,!1,2413422669)}),a("el-table-column",{attrs:{label:"操作",width:"80px",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.deletePropertyInput(t.row,t.$index)}}},[e._v("删除")])]}}],null,!1,3298713)})],1)],1):e._e()],1),a("div",[a("el-row",{staticStyle:{"margin-top":"20px"}},[a("el-button",{staticStyle:{"margin-left":"5%",float:"left"},attrs:{type:"primary",plain:""},on:{click:e.addPropertyInput}},[e._v("添加属性")]),a("el-button",{staticStyle:{"margin-left":"20%"},attrs:{type:"success",plain:""},on:{click:e.addNodeOrLinkFn}},[e._v("确 定")]),a("el-button",{staticStyle:{"margin-right":"10%",float:"right"},on:{click:e.addNodeLinkCancel}},[e._v("取 消")])],1)],1)])],1):e._e(),"link"===e.addNodeOrLink?a("div",[a("el-form",{ref:"addLinkFormRef",attrs:{model:e.addLinkForm,rules:e.addLinkFormRules}},[a("div",{staticStyle:{"margin-left":"5%"},attrs:{align:"left"}},[a("el-form-item",{attrs:{prop:"sourceId"}},[a("el-select",{staticStyle:{width:"90%"},attrs:{placeholder:"请选择起始节点"},model:{value:e.addLinkForm.sourceId,callback:function(t){e.$set(e.addLinkForm,"sourceId",t)},expression:"addLinkForm.sourceId"}},[a("div",{staticClass:"el-input"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.dropDownValueSource,expression:"dropDownValueSource"}],staticClass:"el-input__inner",attrs:{type:"text",placeholder:"请输入"},domProps:{value:e.dropDownValueSource},on:{keyup:e.dropDownSearchSource,input:function(t){t.target.composing||(e.dropDownValueSource=t.target.value)}}})]),e._l(e.kgNodesSourceShow,(function(e){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.id}})}))],2)],1),a("el-form-item",{attrs:{prop:"targetId"}},[a("el-select",{staticStyle:{width:"90%"},attrs:{placeholder:"请选择终止节点"},model:{value:e.addLinkForm.targetId,callback:function(t){e.$set(e.addLinkForm,"targetId",t)},expression:"addLinkForm.targetId"}},[a("div",{staticClass:"el-input"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.dropDownValueTarget,expression:"dropDownValueTarget"}],staticClass:"el-input__inner",attrs:{type:"text",placeholder:"请输入"},domProps:{value:e.dropDownValueTarget},on:{keyup:e.dropDownSearchTarget,input:function(t){t.target.composing||(e.dropDownValueTarget=t.target.value)}}})]),e._l(e.kgNodesTargetShow,(function(e){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.id}})}))],2)],1),a("el-form-item",{attrs:{prop:"name"}},[a("el-select",{staticStyle:{width:"90%"},attrs:{placeholder:"请选择关系名"},model:{value:e.addLinkForm.name,callback:function(t){e.$set(e.addLinkForm,"name",t)},expression:"addLinkForm.name"}},e._l(e.linkTypeOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),a("div",[a("el-row",{staticStyle:{"margin-top":"20px"}},[a("el-button",{staticStyle:{"margin-right":"10%",float:"right"},on:{click:function(t){e.dialogAddLinkVisible=!1}}},[e._v("取 消")]),a("el-button",{staticStyle:{"margin-right":"5%",float:"right"},attrs:{type:"success",plain:""},on:{click:e.addNodeOrLinkFn}},[e._v("确 定")])],1)],1)])],1):e._e()],1),a("el-dialog",{attrs:{title:"修改或删除关系",visible:e.dialogEditLinkVisible,width:"30%"},on:{"update:visible":function(t){e.dialogEditLinkVisible=t}}},[a("el-select",{attrs:{placeholder:"请选择关系"},model:{value:e.relationProNameTmp,callback:function(t){e.relationProNameTmp=t},expression:"relationProNameTmp"}},e._l(e.linkTypeOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.deleteLink}},[e._v("删 除")]),a("el-button",{attrs:{type:"primary"},on:{click:e.editLink}},[e._v("确认修改")]),a("el-button",{on:{click:function(t){e.dialogEditLinkVisible=!1,e.relationProNameTmp=""}}},[e._v("取 消")])],1)],1)],2)])},o=[],i=a("2772"),r=a("435f"),s=(a("bb13"),a("89a8"),a("b110"),a("fe35"),a("10dd"),a("5a05"),a("2788"),a("aa08"),a("993f"),a("b3d9"),a("1926"),a("acc0"),a("4c1e"),a("fee8"),a("715e")),l=a("82b5"),d=(a("daf0"),{name:"Cvs",props:{analysisType:String,domain:String,whichParent:String,advanceSearch:String},data:function(){return{nodes:[],links:[],kgNodes:[],kgNodesSourceShow:[],kgNodesTargetShow:[],kgLinks:[],nodeText:[],linksName:[],simulation:null,width:1100,height:700,initialized:!1,nodeSizeList:new Map,nodeTextLengthList:new Map,scale:s["h"]().range(["#FFC454","#8DCC93","#02A7F1","#f79767","#a496ff","#00933db3","#57C7E3"]),dialogAddLinkVisible:!1,dialogEditLinkVisible:!1,addLinkForm:{sourceId:"",targetId:"",name:""},addNodeForm:{name:"",type:"",property:{}},addNodeFormRules:{type:[{required:!0,message:"请选择一个节点类型",trigger:"change"}],name:[{required:!0,message:"请填写节点名称",trigger:"blur"}]},addLinkFormRules:{sourceId:[{required:!0,message:"请选择起始节点",trigger:"change"}],targetId:[{required:!0,message:"请选择终止节点",trigger:"change"}],name:[{required:!0,message:"请选择关系名称",trigger:"change"}]},nodeTypeOptions:[],addNodeOrLink:"node",linkTypeOptions:[],deleteBtnDis:!1,panelInfo:{},relationPro:-1,relationProNameTmp:"",loading:!1,nodecount:"",SLOption:[{value:"选项1",label:"事件"},{value:"选项2",label:"节点"}],editProperty:[],node:{name:"",type:"",property:{}},dropDownValueSource:"",dropDownValueTarget:"",addPropertyView:!1}},computed:{graphId:function(){return this.$store.getters.getChildGraphId}},created:function(){this.getRelTypeAndNodeTypeFromNeo4j(),this.getNodeCount()},methods:{addNodeLinkCancel:function(){this.dialogAddLinkVisible=!1,this.addPropertyView=!1,this.addNodeForm.name="",this.addNodeForm.type="",this.addNodeForm.property={},this.editProperty=[],this.addPropertyView=!1,this.addLinkForm.sourceId="",this.addLinkForm.targetId="",this.addLinkForm.name=""},dropDownSearchSource:function(){this.addLinkForm.sourceId=[],this.kgNodesSourceShow=this.kgNodes.filter(this.filterSearch)},dropDownSearchTarget:function(){this.addLinkForm.targetId=[],this.kgNodesTargetShow=this.kgNodes.filter(this.filterSearch2)},filterSearch:function(e){return e.name.includes(this.dropDownValueSource)},filterSearch2:function(e){return e.name.includes(this.dropDownValueTarget)},addPropertyInput:function(){this.addPropertyView=!0,this.editProperty.push({0:"",1:""})},deletePropertyInput:function(e,t){this.editProperty.splice(t,1),0==this.editProperty.length&&(this.addPropertyView=!1)},getNodeCount:function(){var e=this;this.axios.get("http://localhost:8082/KG/getGraph",{params:{domain:this.domain}}).then((function(t){e.nodecount=t.data.data.node.length,console.log(e.nodecount)}))},getRelationReason:function(){var e,t=new Map,a=Object(r["a"])(this.kgLinks);try{for(a.s();!(e=a.n()).done;){var n=e.value;t.has(n.name)?t.get(n.name).push({sourceName:n.source.name,targetName:n.target.name}):t.set(n.name,new Array({sourceName:n.source.name,targetName:n.target.name}))}}catch(o){a.e(o)}finally{a.f()}this.$emit("getRelationReason",t)},deleteNodeFn:function(){if(void 0===this.panelInfo.id)return this.$message.warning("请先选中节点");this.whichParent,this.deleteNeo4jNode()},deleteOrEditLink:function(e){-1!==this.graphId||"0"!==this.whichParent?(this.dialogEditLinkVisible=!0,this.relationPro=e,this.relationProNameTmp=e.name,console.log("this.relationPro0"),console.log(this.relationPro)):this.$message.warning("请先选择或保存子图")},deleteLink:function(){var e=this;this.relationPro.name=this.relationProNameTmp;var t=this.relationPro,a=this.relationPro.source.name,n=this.relationPro.target.name,o=this.relationPro.name;this.$confirm('是否确定删除"'+a+'"与"'+n+'"之间的"'+o+'"关系',"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.axios.delete("http://localhost:8082/KG/rel",{params:{id:t.id}}).then((function(a){console.log("删除res"),console.log(a),200===a.data.code?(e.$message.success("删除关系成功"),e.kgLinks.splice(t.index,1),e.renderGraph({nodes:e.kgNodes,links:e.kgLinks})):e.$message.error("删除失败，请刷新重试"),e.dialogEditLinkVisible=!1}))})).catch((function(t){e.$message("取消删除"),e.dialogEditLinkVisible=!1})),this.relationPro=-1},editLink:function(){var e=this;this.axios.get("http://localhost:8082/KG/editRel",{params:{source:this.relationPro.source.id,target:this.relationPro.target.id,id:this.relationPro.id,name:this.relationPro.name}}).then((function(t){if(console.log("res",t),200===t.data.code){e.$message.success("修改关系成功");for(var a=0;a<e.kgLinks.length;a++)if(e.kgLinks[a].id===e.relationPro.id){e.kgLinks[a].name=e.relationPro.name;break}console.log("kgLinksNew"),console.log(e.kgLinks),e.renderGraph({nodes:e.kgNodes,links:e.kgLinks})}else e.$message.error("修改关系失败，请刷新重试");e.dialogEditLinkVisible=!1,e.relationProNameTmp=""}))},saveGraphFn:function(){if("0"===this.whichParent)this.saveChildGraph();else{if("1"!==this.whichParent)return;this.downLoadGraph()}},getRelTypeAndNodeTypeFromNeo4j:function(){var e=this;this.linkTypeOptions=[],this.nodeTypeOptions=[],this.axios.get("http://localhost:8082/KG/getRelLabel",{params:{domain:this.domain}}).then((function(t){var a=t.data.data;if(console.log("关系",t),200===t.data.code){console.log("获取关系类型",a);var n,o=Object(r["a"])(a);try{for(o.s();!(n=o.n()).done;){var i=n.value;e.linkTypeOptions.push({label:i,value:i})}}catch(s){o.e(s)}finally{o.f()}}})),this.axios.get("http://localhost:8082/KG/getLabel",{params:{domain:this.domain}}).then((function(t){var a=t.data.data;console.log("resLabelData",t.data.data);var n,o=Object(r["a"])(a);try{for(o.s();!(n=o.n()).done;){var i=n.value;"NULL"!=i&&i!=e.domain&&e.nodeTypeOptions.push({label:i,value:i})}}catch(s){o.e(s)}finally{o.f()}}))},addNodeOrLinkFn:function(){var e=this;if("0"===this.whichParent){if("node"===this.addNodeOrLink){this.dialogAddLinkVisible=!1;var t,a={name:this.addNodeForm.name,type:this.addNodeForm.type,property:this.addNodeForm.property},n=Object(r["a"])(this.editProperty);try{for(n.s();!(t=n.n()).done;){var o=t.value;""!=o[0]&&null!=o[0]&&""!=o[1]&&null!=o[1]&&(a.property[o[0]]=o[1])}}catch(i){n.e(i)}finally{n.f()}this.addNodeForm.name="",this.addNodeForm.type="",this.addNodeForm.property={},this.editProperty=[],this.addPropertyView=!1,this.$emit("insertNodeInfo",a)}else"link"===this.addNodeOrLink&&(this.dialogAddLinkVisible=!1,this.$refs.addLinkFormRef.validate((function(t){if(console.log(t),t){var a=e.addLinkForm,n=a.sourceId,o=a.targetId;a.name;if(console.log("addLinkForm",e.addLinkForm),n===o)return e.$message.warning("请选择不同的起始节点和终止节点");e.$emit("insertRelInfo",e.addLinkForm),e.addLinkForm.sourceId="",e.addLinkForm.targetId="",e.addLinkForm.name=""}})));this.renderGraph({nodes:this.kgNodes,links:this.kgLinks})}else{if("1"!==this.whichParent)return;"node"===this.addNodeOrLink?this.$refs.addNodeFormRef.validate((function(t){if(t){var a,n=e.addNodeForm,o=n.name,s=n.type,l=Object(r["a"])(e.kgNodes);try{for(l.s();!(a=l.n()).done;){var d=a.value;if(o===d.name&&s===d.type[0])return e.$message.warning("当前图谱中已显示该节点")}}catch(i){l.e(i)}finally{l.f()}e.addNode("graph/".concat(s,"/").concat(o))}})):"link"===this.addNodeOrLink&&this.$refs.addLinkFormRef.validate((function(t){if(t){var a=e.addLinkForm,n=a.sourceId,o=a.targetId,i=a.name;if(n===o)return e.$message.warning("请选择不同的起始节点和终止节点");e.addReletion("graph/createrel/".concat(n,"/").concat(o,"/").concat(i))}}))}},deleteNeo4jNode:function(){var e=this;this.panelInfo!=={}&&this.$confirm('此操作将永久删除节点 "'+this.panelInfo.name+' "，是否继续？',"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){console.log("删除"),e.$emit("deleteNodeInfo",e.panelInfo)})).catch((function(){e.$message({type:"info",message:"已取消删除"})}))},deleteMysqlNode:function(){var e=this;console.log(this.graphId),-1!==this.graphId||"0"!==this.whichParent?this.panelInfo!=={}&&this.$confirm("此操作将永久删除节点"+this.panelInfo.name+"，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){console.log("要删除的节点",e.panelInfo);var t=e.panelInfo.id;e.$http.delete("ga//deleteNodeInNeo4jID?id="+t).then((function(a){if(console.log("删除节点响应数据",a),200==a.data.code){e.kgNodes.splice(e.panelInfo.index,1),console.log("已删除节点");for(var n=e.kgLinks.length-1;n>=0;n--)e.kgLinks[n].source.id!=t&&e.kgLinks[n].target.id!=t||e.kgLinks.splice(n,1);return console.log("5"),e.renderGraph({nodes:e.kgNodes,links:e.kgLinks}),e.panelInfo={},e.getNodeCount(),e.$message.success("删除成功")}}))})).catch((function(){e.$message({type:"info",message:"已取消删除"})})):this.$message({type:"warning",message:"请先选择或保存子图"})},addNode:function(e){var t=this;this.$http.post(e).then((function(e){if(200===e.data.code){var a;a=(t.whichParent,e.data.data),t.kgNodes.push({id:a,name:t.addNodeForm.name,type:[t.addNodeForm.type],properties:{name:t.addNodeForm.name}});var n={nodes:t.kgNodes,links:t.kgLinks};console.log(n),console.log("6"),t.renderGraph(n),!0===e.data.data.isEntity?t.$message.warning("该节点已存在"):t.$message({type:"success",message:"创建成功"}),t.dialogAddLinkVisible=!1,t.addNodeForm.name="",t.addNodeForm.type="",t.getNodeCount()}}))},addReletion:function(e){var t=this;console.log(e),this.$http.post(e).then((function(e){if(200===e.data.code){console.log(e),t.kgLinks.push({id:e.data.data,name:t.addLinkForm.name,source:t.addLinkForm.sourceId,target:t.addLinkForm.targetId,properties:{}});var a={nodes:t.kgNodes,links:t.kgLinks};console.log(a),console.log("7"),t.renderGraph(a),t.$message({type:"success",message:"创建成功"}),t.addLinkForm.name="",t.addLinkForm.sourceId="",t.addLinkForm.targetId="",t.dialogAddLinkVisible=!1}}))},addNodeOrLinkBefore:function(){-1!==this.graphId||"0"!==this.whichParent?this.dialogAddLinkVisible=!0:this.$message({type:"warning",message:"请先选择或保存子图"})},renderGraph:function(e){var t=this;console.log("渲染图谱的数据",e),this.dealRealtions(e.links),this.kgNodes=e.nodes,this.kgNodesSourceShow=this.kgNodes,this.kgNodesTargetShow=this.kgNodes,this.kgLinks=e.links,console.log("initialized"+this.initialized),this.initialized||(this.initGraph(e),this.initialized=!0),this.updategraph(e),this.$nextTick((function(){"0"===t.whichParent&&t.getRelationReason()}))},initGraph:function(e){var t=this;console.log("初始化画布...",e);var a=this,n=e.links,o=e.nodes;a.simulation=s["g"](o).force("link",s["e"](n).id((function(e){return e.id})).distance(200)).force("charge",s["f"]().strength(-1e3).distanceMin(10).distanceMax(800)).force("collision",s["d"](1).strength(.1)).force("center",s["c"](a.width/2,a.height/2));var r=s["i"](".canvas-container").append("svg").attr("width","100%").attr("height","82vh"),l=r.append("g");r.append("marker").attr("id","positiveMarker").attr("orient","auto").attr("stroke-width",2).attr("markerUnits","strokeWidth").attr("markerUnits","userSpaceOnUse").attr("viewBox","0 -5 10 10").attr("refX",11).attr("refY",0).attr("markerWidth",12).attr("markerHeight",12).append("path").attr("d","M 0 -5 L 10 0 L 0 5").attr("fill","#999").attr("stroke-opacity",.6),r.append("marker").attr("id","negativeMarker").attr("orient","auto").attr("stroke-width",2).attr("markerUnits","strokeWidth").attr("markerUnits","userSpaceOnUse").attr("viewBox","0 -5 10 10").attr("refX",0).attr("refY",0).attr("markerWidth",12).attr("markerHeight",12).append("path").attr("d","M 0 0 L 10 5 L 10 -5").attr("fill","#999").attr("stroke-opacity",.6),r.call(s["j"]().scaleExtent([.1,2]).on("zoom",(function(){l.attr("transform",s["b"].transform)}))).on("dblclick.zoom",(function(){})),a.links=l.append("g").selectAll("path").data(n,(function(e){return"object"===Object(i["a"])(e.source)?e.source.id+"_"+e.name+"_"+e.target.id:e.source+"_"+e.name+"_"+e.target})).join("path").attr("class","link").attr("id",(function(e){return"object"===Object(i["a"])(e.source)?e.source.id+"_"+e.name+"_"+e.target.id:e.source+"_"+e.name+"_"+e.target})),a.linksName=l.append("g").selectAll("text").data(n).join("text").attr("class","linksName").on("dblclick",a.deleteOrEditLink).append("textPath").attr("xlink:href",(function(e){return"object"===Object(i["a"])(e.source)?"#"+e.source.id+"_"+e.name+"_"+e.target.id:"#"+e.source+"_"+e.name+"_"+e.target})).attr("startOffset","50%").text((function(e){return e.name})),a.nodes=l.append("g").selectAll("circle").data(o).join("circle").attr("class","node").attr("r",30).attr("fill",a.color()).on("click",a.queryTest).call(a.drag(a.simulation)),a.nodes.append("title").text((function(e){return e.name})),a.nodeText=l.append("g").selectAll("text").data(o).join("text").text((function(e){var a=e.name,n=t.nodeTextLengthList.has(e.type)?t.nodeTextLengthList.get(e.type):6;return a.length>n?a.slice(0,n)+"...":e.name})).attr("dy",2).style("pointer-events","none").attr("class","node-text"),a.simulation.on("tick",(function(){a.links.attr("d",(function(e){var t=0,a=e.target.x-e.source.x,n=e.target.y-e.source.y,o=Math.sqrt(a*a+n*n),i=a/o,r=n/o,s=e.source.x+t*i,l=e.source.y+t*r,d=e.target.x-t*i,c=e.target.y-t*r;if(e.target==e.source)return g=38/e.linknum,"M"+s+","+l+"A"+g+","+g+" 0 1,1 "+d+","+(c+1);if(e.size%2!=0&&1==e.linknum)return"M"+s+" "+l+" L "+d+" "+c;var u=1.5,p=1.2,g=Math.sqrt(a*a+n*n)*(e.linknum+p)/(u*p);return e.linknum<0?(g=Math.sqrt(a*a+n*n)*(-1*e.linknum+p)/(u*p),"M"+s+","+l+"A"+g+","+g+" 0 0,0 "+d+","+c):"M"+s+","+l+"A"+g+","+g+" 0 0,1 "+d+","+c})).attr("d",(function(e){return e.source.x<e.target.x?"M "+a.getCoord(e.target,e.source)+" L "+a.getCoord(e.source,e.target):"M "+a.getCoord(e.source,e.target)+" L "+a.getCoord(e.target,e.source)})).attr("marker-end",(function(e){return e.source.x<e.target.x?"url(#positiveMarker)":null})).attr("marker-start",(function(e){return e.source.x>e.target.x?"url(#negativeMarker)":null})),a.nodes.attr("cx",(function(e){return e.x})).attr("cy",(function(e){return e.y})),a.nodeText.attr("x",(function(e){return e.x})).attr("y",(function(e){return e.y}))}))},getCoord:function(e,t){var a=30;this.nodeSizeList.has(t.type)&&(a=this.nodeSizeList.get(t.type));var n=a/Math.sqrt(Math.pow(t.y-e.y,2)+Math.pow(t.x-e.x,2)),o=t.x-n*(t.x-e.x),i=t.y-n*(t.y-e.y);return o+" "+i},color:function(){var e=this;return function(t){return e.scale(t.type)}},displayLinks:function(e){return this.scale(e.name)},drag:function(e){function t(t){t.active||e.alphaTarget(.3).restart(),t.fx=t.x,t.fy=t.y}function a(e){e.fx=s["b"].x,e.fy=s["b"].y}function n(t){t.active||e.alphaTarget(0),t.fx=null,t.fy=null}return s["a"]().on("start",t).on("drag",a).on("end",n)},queryTest:function(e){console.log("canvas",e),this.panelInfo=e,this.$emit("clickNode",e)},updategraph:function(e){var t=this;console.log("更新图谱数据...",e);var a=this,n=e.links,o=e.nodes;a.links=a.links.data(n,(function(e){return"object"===Object(i["a"])(e.source)?e.source.id+"_"+e.name+"_"+e.target.id:e.source+"_"+e.name+"_"+e.target})).join("path").merge(a.links).attr("class","link").attr("stroke",(function(e){return a.displayLinks(e)})).attr("id",(function(e){return"object"===Object(i["a"])(e.source)?e.source.id+"_"+e.name+"_"+e.target.id:e.source+"_"+e.name+"_"+e.target})),a.linksName=a.linksName.data(n,(function(e){return"object"===Object(i["a"])(e.source)?e.source.id+"_"+e.name+"_"+e.target.id:e.source+"_"+e.name+"_"+e.target})).join("text").attr("class","linksName").append("textPath").attr("xlink:href",(function(e){return"object"===Object(i["a"])(e.source)?"#"+e.source.id+"_"+e.name+"_"+e.target.id:"#"+e.source+"_"+e.name+"_"+e.target})).attr("startOffset","50%").on("dblclick",a.deleteOrEditLink).text((function(e){return e.name})).merge(a.linksName).append("text"),a.nodes=a.nodes.data(o).join("circle").merge(a.nodes).on("click",a.queryTest).call(a.drag(a.simulation)).attr("class","node").attr("r",(function(e){return a.nodeSizeList.has(e.type)?a.nodeSizeList.get(e.type):30})).attr("fill",a.color()),a.nodes.append("title").text((function(e){return e.name})),a.nodeText=a.nodeText.data(o).join("text").merge(a.nodeText).text((function(e){var a=e.name,n=t.nodeTextLengthList.has(e.type)?t.nodeTextLengthList.get(e.type):6;return a.length>n?a.slice(0,n)+"...":e.name})).attr("dy",2).style("pointer-events","none").attr("class","node-text"),a.simulation.nodes(o),a.simulation.force("link").links(n),a.simulation.alpha(1).restart()},saveChildGraph:function(){var e=this;if(0===this.kgNodes.length)return this.$message.warning("当前图谱为空");this.$prompt("请输入该子图名称","保存子图",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/\S/,inputErrorMessage:"名称不能为空"}).then((function(t){var a=t.value;e.loading=!0;var n,o=[],i=Object(r["a"])(e.kgLinks);try{for(i.s();!(n=i.n()).done;){var s=n.value;o.push({id:s.id,sourceId:s.source.id,targetId:s.target.id,properties:{},name:s.name})}}catch(d){i.e(d)}finally{i.f()}var l={graph:{nodes:e.kgNodes,links:o}};console.log(l),e.$http.post("/ga/saveGraph?name="+a+"&type="+e.analysisType,l).then((function(t){if(e.loading=!1,200==t.data.code){console.log(t),e.$message({type:"success",message:"保存成功"});var n={name:a,graphList:t.data.data.graphList};e.$emit("getGraphList",n),console.log(n),e.$store.commit("setChildGraphId",t.data.data.id)}})).catch((function(t){e.loading=!1,e.$message({type:"warning",message:"操作超时，请重试"})}))})).catch((function(){e.$message({type:"info",message:"取消输入"})}))},downLoadGraph:function(){if(s["i"](".canvas-container").select("svg").node()){var e=new Date,t="BM图谱_"+e.toLocaleString()+".png";Object(l["saveSvgAsPng"])(s["i"](".canvas-container").select("svg").node(),t,{scale:10})}else this.$message({showClose:!0,message:"没有要下载的图谱"})},dealRealtions:function(e){for(var t={},a={},n=0;n<e.length;n++){if("object"===Object(i["a"])(e[n].source))var o=e[n].source.id<e[n].target.id?e[n].source.id+":"+e[n].target.id:e[n].target.id+":"+e[n].source.id;else o=e[n].source<e[n].target?e[n].source+":"+e[n].target:e[n].target+":"+e[n].source;a.hasOwnProperty(o)||(a[o]=0),a[o]+=1,t.hasOwnProperty(o)||(t[o]=[]),t[o].push(e[n])}console.log(t),console.log(a);for(n=0;n<e.length;n++){if("object"===Object(i["a"])(e[n].source))o=e[n].source.id<e[n].target.id?e[n].source.id+":"+e[n].target.id:e[n].target.id+":"+e[n].source.id;else o=e[n].source<e[n].target?e[n].source+":"+e[n].target:e[n].target+":"+e[n].source;e[n].size=a[o];var r=t[o],s=o.split(":"),l="noself";s[0]==s[1]&&(l="self"),this.setLinkNumber(r,l)}},setLinkNumber:function(e,t){if(0!==e.length){for(var a=[],n=[],o=0;o<e.length;o++){var r=e[o];"object"===Object(i["a"])(r.source)?r.source.id<r.target.id?a.push(r):n.push(r):r.source<r.target?a.push(r):n.push(r)}var s=1;if(s="self"===t?e.length:e.length%2===0?e.length/2:(e.length+1)/2,a.length===n.length){var l=1;for(o=0;o<a.length;o++)a[o].linknum=l++;l=1;for(o=0;o<n.length;o++)n[o].linknum=l++}else{var d,c;a.length>n.length?(d=a,c=n):(d=n,c=a);for(l=s,o=0;o<c.length;o++)c[o].linknum=l--;var u=l;l=1;var p=0;while(l<=s)d[p++].linknum=l++;l=0-u;for(o=p;o<d.length;o++)d[o].linknum=l++}}}}}),c=d,u=(a("07b7"),a("cba8")),p=Object(u["a"])(c,n,o,!1,null,null,null);t["a"]=p.exports}}]);